#!/usr/bin/env ruby

opts = ARGV.getopts('', 'host:localhost', 'mount:__web_console', 'proto:http')

if ARGV.empty?
  puts <<-EOF
web_console_auth [--host] [--mount] [--proto] <PORT>
or web_console_auth <URL>
EOF
else
  url = if URI.regexp =~ ARGV.first
    URI.join(ARGV.first, "#{opts['mount']}/auth/secret")
  else
    "#{opts['proto']}://#{opts['host']}:#{ARGV.first}/#{opts['mount']}/auth/secret"
  end
  system "curl -s -X POST #{url}"
end

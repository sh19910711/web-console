(function(global, original) {
  if (!original) return;
  XMLHttpRequest.prototype.open = function(_args_) {
    var self = this;
    self.addEventListener('readystatechange', function() {
      if (self.readyState === 4) {
        function header(key) { return self.getResponseHeader(key); }
        if (header('X-Web-Console') === '1') {
          console.log('hijacked xhr');
          REPLConsole.installInto('console', REPLConsole.parseHeaders(header));
        }
      }
    }, false);
    original.apply(self, arguments);
  };
})(window, window.XMLHttpRequest.prototype.open);
